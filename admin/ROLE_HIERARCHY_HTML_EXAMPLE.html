<!-- 
  ADMIN PANEL HTML ADDITIONS
  These elements should be added to admin/index.html to support the new features.
  Place modals in the appropriate section of your existing HTML.
-->

<!-- ========== ROLE HIERARCHY MANAGEMENT MODAL ========== -->
<div id="roleHierarchyModal" class="modal hidden" role="dialog" aria-labelledby="roleHierarchyTitle">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-bottom: 1px solid #30363d;">
      <h2 id="roleHierarchyTitle" style="margin: 0; color: #c9d1d9; font-size: 1.2rem;">Role Hierarchy Management</h2>
      <button class="modal-close-btn" data-modal="roleHierarchyModal" style="background: none; border: none; color: #8b949e; cursor: pointer; font-size: 1.5rem;">
        ‚úï
      </button>
    </div>
    
    <div class="modal-body" style="padding: 1.5rem;">
      <p style="color: #8b949e; margin-bottom: 1.5rem; font-size: 0.9rem;">
        üìã Drag roles to reorder them. <strong>Higher positions = Higher authority.</strong> Changes are saved automatically.
      </p>
      
      <div id="roleHierarchyList" style="max-height: 500px; overflow-y: auto; border: 1px solid #30363d; border-radius: 8px; padding: 0.5rem;">
        <!-- Dynamically populated -->
      </div>
      
      <div style="margin-top: 1rem; color: #8b949e; font-size: 0.85rem;">
        <strong>Current Hierarchy:</strong>
        <div id="hierarchyInfo" style="margin-top: 0.5rem; padding: 0.5rem; background: #0d1117; border-radius: 4px;">
          <!-- Updated dynamically -->
        </div>
      </div>
    </div>
    
    <div class="modal-footer" style="padding: 1rem 1.5rem; border-top: 1px solid #30363d; text-align: right;">
      <button onclick="closeRoleHierarchyModal()" style="padding: 0.5rem 1rem; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">
        Done
      </button>
    </div>
  </div>
</div>

<!-- ========== ADMIN SETTINGS MODAL (Add Role Hierarchy Button) ========== -->
<!-- 
  If you have an adminSettingsModal, add this button to it:
-->
<button onclick="openRoleHierarchySettings()" style="
  width: 100%;
  padding: 0.7rem;
  background: #238636;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  margin: 0.5rem 0;
  transition: background 0.2s;
" onmouseover="this.style.background='#2ea043'" onmouseout="this.style.background='#238636'">
  ‚öôÔ∏è Manage Role Hierarchy
</button>

<!-- ========== TOOLBAR BUTTON (Optional) ========== -->
<!-- 
  Add this button to your admin toolbar if you want quick access:
-->
<button 
  id="roleHierarchyBtn"
  onclick="openRoleHierarchySettings()"
  title="Manage role hierarchy and permissions"
  style="
    padding: 0.5rem 1rem;
    background: #238636;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: background 0.2s;
  "
  onmouseover="this.style.background='#2ea043'"
  onmouseout="this.style.background='#238636'"
>
  ‚öôÔ∏è Role Hierarchy
</button>

<!-- ========== CSS STYLES ========== -->
<style>
  /* Modal styles */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .modal.hidden {
    display: none;
  }

  .modal-content {
    background: #0d1117;
    border: 1px solid #30363d;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    max-height: 90vh;
    overflow-y: auto;
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    background: #161b22;
    padding: 1.5rem;
    border-bottom: 1px solid #30363d;
    position: sticky;
    top: 0;
  }

  .modal-header h2 {
    margin: 0;
    color: #c9d1d9;
    font-size: 1.2rem;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid #30363d;
    text-align: right;
    background: #0d1117;
    position: sticky;
    bottom: 0;
  }

  .modal-close-btn {
    background: none;
    border: none;
    color: #8b949e;
    cursor: pointer;
    font-size: 1.5rem;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
  }

  .modal-close-btn:hover {
    color: #c9d1d9;
  }

  /* Role hierarchy list styles */
  #roleHierarchyList {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  #roleHierarchyItems li {
    padding: 1rem;
    margin: 0.5rem 0;
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 6px;
    cursor: move;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s;
    user-select: none;
  }

  #roleHierarchyItems li:hover {
    background: #1c2128;
    border-color: #30363d;
  }

  #roleHierarchyItems li.drag-over {
    background: #30363d;
    border-color: #58a6ff;
  }

  #roleHierarchyItems li[draggable="true"] {
    cursor: grab;
  }

  #roleHierarchyItems li[draggable="true"]:active {
    cursor: grabbing;
  }

  /* Drag handle styles */
  .drag-handle {
    cursor: grab;
    color: #8b949e;
    font-size: 1.2rem;
    margin-right: 0.5rem;
  }

  .drag-handle:active {
    cursor: grabbing;
  }

  /* Role color swatch */
  .role-color-swatch {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    margin-right: 0.75rem;
    border: 1px solid #30363d;
  }

  /* Role info section */
  .role-info {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex: 1;
  }

  .role-name {
    font-weight: 500;
    color: #c9d1d9;
  }

  .role-order {
    font-size: 0.8rem;
    color: #8b949e;
    margin-top: 0.2rem;
  }

  /* Hierarchy info display */
  #hierarchyInfo {
    background: #0d1117;
    border: 1px solid #30363d;
    border-radius: 4px;
    padding: 0.75rem;
    font-family: 'Monaco', 'Courier New', monospace;
    font-size: 0.85rem;
    color: #8b949e;
    max-height: 200px;
    overflow-y: auto;
  }

  #hierarchyInfo div {
    padding: 0.25rem 0;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .modal-content {
      max-width: 95vw;
    }

    #roleHierarchyItems li {
      flex-direction: column;
      align-items: flex-start;
    }

    .role-info {
      width: 100%;
    }
  }
</style>

<!-- ========== SCRIPT INTEGRATION ========== -->
<script>
  // Initialize role hierarchy on page load
  document.addEventListener('DOMContentLoaded', async () => {
    // Fetch and cache role hierarchy
    roleHierarchy = await fetchRoleHierarchy();
    console.log('Role hierarchy loaded:', roleHierarchy);

    // Setup role hierarchy button if it exists
    const roleHierarchyBtn = document.getElementById('roleHierarchyBtn');
    if (roleHierarchyBtn) {
      roleHierarchyBtn.addEventListener('click', openRoleHierarchySettings);
    }
  });

  // Update hierarchy info display when modal is opened
  function updateHierarchyInfo(roles) {
    const infoDiv = document.getElementById('hierarchyInfo');
    if (!infoDiv) return;

    if (roles.length === 0) {
      infoDiv.innerHTML = '<div style="color: #8b949e;">No roles defined</div>';
      return;
    }

    const html = roles.map((role, idx) => `
      <div style="color: #58a6ff;">
        <span style="color: #8b949e;">[${idx + 1}]</span>
        <span style="color: #c9d1d9;">${role.role_name}</span>
        <span style="color: #8b949e;">(${role.hierarchy_order})</span>
      </div>
    `).join('');

    infoDiv.innerHTML = html;
  }

  // Hook into openRoleHierarchySettings to update the info display
  const originalOpenRoleHierarchySettings = openRoleHierarchySettings;
  openRoleHierarchySettings = async function() {
    const result = await originalOpenRoleHierarchySettings.call(this);
    updateHierarchyInfo(roleHierarchy);
    return result;
  };
</script>

<!-- ========== USAGE NOTES ========== -->
<!--
  1. Place the roleHierarchyModal div before the closing </body> tag
  
  2. Add the "Manage Role Hierarchy" button to your admin settings section
  
  3. Optionally add the roleHierarchyBtn to your toolbar for quick access
  
  4. Include the CSS styles in your admin/style.css or <style> tag
  
  5. The script integration should be added after your main script.js loads
  
  6. Make sure the script.js file includes all the role hierarchy functions:
     - fetchRoleHierarchy()
     - saveRoleHierarchy()
     - openRoleHierarchySettings()
     - renderRoleHierarchyList()
     - closeRoleHierarchyModal()
  
  7. Test the drag-and-drop functionality by opening the modal and dragging roles
  
  8. Verify that role changes persist by refreshing the page
-->
